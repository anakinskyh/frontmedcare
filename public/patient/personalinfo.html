
<!doctype html>
<html lang="en">
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js">
</script>
<style type"text/css">
.top-buffer { margin-top:20px; }
</style>
</head>
<body>
    <div class="header"></div>
    <script>
        $(".header").load("/assets/html/header.html");
    </script>
    <div id="wrapper">
      <nav class="navbar navbar-inverse navbar-fixed-top navigatebar" role="navigation"></nav>
      <script>
          $(".navigatebar").load("/assets/html/patientnav.html", function(){
            $("#personalinfo").addClass("active");
          });
      </script>

      <!-- page content -->
      <div id="page-wrapper">

          <div class="container-fluid">

              <!-- Page Heading -->
              <div class="row">
                  <div class="col-lg-12">
                      <h1 class="page-header">
                          ประวัติส่วนตัว
                      </h1>
                  </div>
              </div>
              <!-- /.row -->

              <!-- Profile info -->
              <div class="row" id="showProfileDiv">
                <div class="col-md-12">
                  <div class="col-md-3">
                  </div>
                  <ol class="breadcrumb col-md-5">
                    <div class="pull-right">
                      <a role="button" class="btn btn-sm btn-default" id="editButton"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> แก้ไข</a>
                    </div>
                    <div class="top-buffer">
                      <h2 id="p-name">-</h2>
                    <br>
                    <form role="form">

                      <div class="form-group">
                        <label>รหัสประจำตัวประชาชน</label>
                        <p class="form-control-static" id="citizenId">-</p>
                      </div>
                      <div class="form-group">
                        <label>ที่อยู่</label>
                        <p class="form-control-static" id="p-address">-</p>
                      </div>
                      <div class="form-group">
                        <label>เพศ</label>
                        <p class="form-control-static" id="sex">-</p>
                      </div>
                      <div class="form-group">
                        <label>กรุ๊ปเลือด</label>
                        <p class="form-control-static" id="bloodtype">-</p>
                      </div>
                      <div class="form-group">
                        <label>อีเมล์</label>
                        <p class="form-control-static" id="p-email">-</p>
                      </div>
                      <div class="form-group">
                        <label>เบอร์โทรศัพท์</label>
                        <p class="form-control-static" id="tel-no">-</p>
                      </div>
                    </form>
                    </div>
                  </ol>
                </div>
              </div>

              <div class="row" id="editProfileDiv">
                <form role="form" name="profileform">
                  <div class="col-md-12">
                    <div class="col-md-3">
                    </div>
                    <ol class="breadcrumb col-md-5">
                      <div class="pull-right">
                        <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#confirmModal"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> บันทึก</button>
                        <button type="reset" class="btn btn-sm btn-default"><span class="glyphicon glyphicon-repeat" aria-hidden="true"></span> รีเซ็ต</button>
                      </div>
                      <div class="form-group top-buffer">
                        <label>ชื่อ</label>
                        <input class="form-control" id="p-fname" type="text" required autocomplete="off" onkeypress='return event.charCode >= 3585 && event.charCode <= 3662'></input>
                      </div>
                      <div class="form-group">
                        <label>นามสกุล</label>
                        <input class="form-control" id="p-lname" type="text" required autocomplete="off"></input>
                      </div>
                      <div class="form-group">
                        <label>รหัสประจำตัวประชาชน</label>
                        <input class="form-control" id="cid" type="text" required autocomplete="off"></input>
                      </div>
                      <div class="form-group">
                        <label>ที่อยู่</label>
                        <textarea class="form-control" id="p-addr" rows="3"></textarea>
                      </div>
                      <div class="form-group">
                        <label>เพศ</label>

                            <label class="radio-inline">
                              <input type="radio" id="male" name="sexOption" value="ชาย" checked>ชาย
                            </label>
                            <label class="radio-inline">
                              <input type="radio" id="female" name="sexOption" value="หญิง">หญิง
                            </label>

                      </div>
                      <div class="form-group">
                        <div class="form-inline">
                          <label class="col-md-4 control-label">กรุ๊ปเลือด</label>
                          <div class="col-md-3">
                            <select class="form-control" id="m-blood-1" value="O">
                              <option value="A">A</option>
                              <option value="B">B</option>
                              <option value="O" selected>O</option>
                              <option value="AB">AB</option>
                            </select>
                          </div>
                          <label class="col-md-2 control-label">Rh</label>
                          <div class="col-md-3">
                            <select class="form-control" id="m-blood-2">
                              <option value="+" selected>+</option>
                              <option value="-">-</option>
                            </select>
                          </div>
                        </div>
                      </div>
                      <div class="form-group">
                        <label>อีเมล์</label>
                          <input class="form-control" id="m-email" type="email" required autocomplete="off">
                      </div>
                      <div class="form-group">
                        <label>เบอร์โทรศัพท์</label>
                          <input class="form-control" id="m-tel" type="tel" maxlength="10">
                      </div>
                    </ol>
                  </div>
                </form>
              </div>

              <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title" id="editModalLabel">การแก้ไขประวัติส่วนตัว</h4>
                    </div>
                    <div class="modal-body">
                      <p>กรุณายืนยัน แก้ไขใช่หรือไม่</p>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">ปิด</button>
                      <button type="button" class="btn btn-primary" data-dismiss="modal" id="confirmButton">ยืนยัน</button>
                    </div>
                  </div>
                </div>
              </div>

          </div>
          <!-- /.container-fluid -->

      </div>
      <!-- /#page-wrapper -->

      <script>
      $(function(){
        $('#editProfileDiv').hide();
          $.post("http://139.59.234.220:5050/api/v1/getpatientinfo",
          {
              patient_id : sessionStorage.id
          },
          function(data,status){
              //alert("Data: " + data[0].ssn + "\nStatus: " + status);
              $('#p-name').text(data[0].firstname+" "+data[0].lastname)
              $('#citizenId').text(data[0].ssn)
              $('#p-address').text(data[0].address)
              if(data[0].gender==="W") $('#sex').text("หญิง")
              else $('#sex').text("ชาย")
              $('#bloodtype').text(data[0].blood)
              $('#p-email').text(data[0].email)
              $('#tel-no').text(data[0].tel)

              var tmp = $('#p-fname')
              tmp.val(data[0].firstname)
              tmp = $('#p-lname')
              tmp.val(data[0].lastname)
              tmp = $('#cid')
              tmp.val(data[0].ssn)
              tmp = $('#p-addr')
              tmp.val(data[0].address)
              if(data[0].gender==="W"){
                tmp = $('#female')
                tmp.prop('checked',true)
              }
              else {
                tmp = $('#male')
                tmp.prop('checked',true)
              }
              tmp = $('#m-blood-1')
              var bld = data[0].blood.split(" ")
              tmp.val(bld[0])
              tmp = $('#m-blood-2')
              tmp.val(bld[1])
              tmp = $('#m-email')
              tmp.val(data[0].email)
              tmp = $('#m-tel')
              tmp.val(data[0].tel)
          });

          $('#editButton').click(function(){
            $('#showProfileDiv').hide();
            $('#editProfileDiv').show();
          })

          $('#confirmButton').click(function(){
            $.post("http://139.59.234.220:5050/api/v1/editpatientinfo",
            {
                patient_id : sessionStorage.id,
                firstname : $('#p-fname').val(),
                lastname : $('#p-lname').val(),
                email : $('#m-email').val(),
                gender : ($('input[name=sexOption]:checked').val()==="หญิง") ? "W" : "M",
                ssn : $('#cid').val(),
                address : $('#p-addr').val(),
                tel : $('#m-tel').val(),
                blood : $('#m-blood-1').find(":selected").text()+" "+$('#m-blood-2').find(":selected").text()
            }).done(function(data,status){
              $('#searchbtn').click()
            })
            .fail(function(xhr,status,error){
              alert(status+": "+xhr.responsText)
            });
          })
      })
      </script>

    </div>
</body>
