
<!doctype html>
<html lang="en">
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js">
</script>
<style type"text/css">
.top-buffer { margin-top:20px; }
</style>
</head>
<body>
  <div class="header"></div>
  <script>
      $(".header").load("/assets/html/header.html");
  </script>
  <div id="wrapper">
    <nav class="navbar navbar-inverse navbar-fixed-top navigatebar" role="navigation"></nav>
    <script>
      $(".navigatebar").load("/assets/html/staffnav.html", function(){
        $("#patientinfo").addClass("active");
      });
    </script>

    <!-- page content -->
    <div id="page-wrapper">

        <div class="container-fluid">

            <!-- Page Heading -->
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">
                        ประวัติส่วนตัวผู้ป่วย
                    </h1>
                </div>
            </div>
            <!-- /.row -->

            <div class="row" id="searchbar">
              <div class="col-lg-3">
                <div class="input-group">
                  <input type="text" class="form-control" placeholder="ID ผู้ป่วย" id="searchbox">
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="button" id="searchbtn">ค้นหา</button>
                  </span>
                </div><!-- /input-group -->
              </div><!-- /.col-lg-6 -->
            </div>

            <div class="row" id="p-profile">
              <div class="col-md-12">
                <div class="col-md-3">
                </div>
                <ol class="breadcrumb col-md-5">
                  <div class="pull-right">
                    <a role="button" class="btn btn-sm btn-default" id="editBtn"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> แก้ไข</a>
                  </div>
                  <div class="top-buffer">
                    <h2 id="p-name">-</h2>
                  <br>
                  <form role="form">

                    <div class="form-group">
                      <label>รหัสประจำตัวประชาชน</label>
                      <p class="form-control-static" id="citizenId">-</p>
                    </div>
                    <div class="form-group">
                      <label>ที่อยู่</label>
                      <p class="form-control-static" id="p-address">-</p>
                    </div>
                    <div class="form-group">
                      <label>เพศ</label>
                      <p class="form-control-static" id="sex">-</p>
                    </div>
                    <div class="form-group">
                      <label>กรุ๊ปเลือด</label>
                      <p class="form-control-static" id="bloodtype">-</p>
                    </div>
                    <div class="form-group">
                      <label>อีเมล์</label>
                      <p class="form-control-static" id="p-email">-</p>
                    </div>
                    <div class="form-group">
                      <label>เบอร์โทรศัพท์</label>
                      <p class="form-control-static" id="tel-no">-</p>
                    </div>
                  </form>
                  </div>
                </ol>
              </div>
            </div>

            <div class="row" id="p-editprofile">
              <form role="form" name="profileform">
                <div class="col-md-12">
                  <div class="col-md-3">
                  </div>
                  <ol class="breadcrumb col-md-5">
                    <div class="pull-right">
                      <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#confirmModal"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> บันทึก</button>
                      <button type="reset" class="btn btn-sm btn-default"><span class="glyphicon glyphicon-repeat" aria-hidden="true"></span> รีเซ็ต</button>
                      <a role="button" class="btn btn-sm btn-default" onclick="back2Profile()"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span> กลับ</a>
                    </div>
                    <div class="form-group top-buffer">
                      <label>ชื่อ</label>
                      <input class="form-control" required id="p-fname" type="text" onkeypress='return event.charCode >= 3585 && event.charCode <= 3662'></input>
                    </div>
                    <div class="form-group">
                      <label>นามสกุล</label>
                      <input class="form-control" required id="p-lname" type="text"></input>
                    </div>
                    <div class="form-group">
                      <label>รหัสประจำตัวประชาชน</label>
                      <input class="form-control" required id="cid" type="text"></input>
                    </div>
                    <div class="form-group">
                      <label>ที่อยู่</label>
                      <textarea class="form-control" required id="p-addr" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                      <label>เพศ</label>

                          <label class="radio-inline">
                            <input type="radio" id="male" name="sexOption" value="ชาย" checked>ชาย
                          </label>
                          <label class="radio-inline">
                            <input type="radio" id="female" name="sexOption" value="หญิง">หญิง
                          </label>

                    </div>
                    <div class="form-group">
                      <div class="form-inline">
                        <label class="col-md-4 control-label">กรุ๊ปเลือด</label>
                        <div class="col-md-3">
                          <select class="form-control" id="m-blood-1" value="O">
                            <option>A</option>
                            <option>B</option>
                            <option>O</option>
                            <option>AB</option>
                          </select>
                        </div>
                        <label class="col-md-2 control-label">Rh</label>
                        <div class="col-md-3">
                          <select class="form-control" id="m-blood-2">
                            <option selected>+</option>
                            <option>-</option>
                          </select>
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <label>อีเมล์</label>
                        <input class="form-control" required id="m-email" type="email">
                    </div>
                    <div class="form-group">
                      <label>เบอร์โทรศัพท์</label>
                        <input class="form-control" id="m-tel" type="tel" maxlength="10">
                    </div>
                  </ol>
                </div>
              </form>
            </div>

                <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="editModalLabel">การแก้ไขประวัติส่วนตัว</h4>
                      </div>
                      <div class="modal-body">
                        <p>กรุณายืนยัน แก้ไขใช่หรือไม่</p>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">ปิด</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" id="confirmButton">ยืนยัน</button>
                      </div>
                    </div>
                  </div>
                </div>

        </div>
        <!-- /.container-fluid -->

    </div>
    <!-- /#page-wrapper -->
  </div>

  <script>
  function back2Profile(){
    $('#p-profile').show()
    $('#p-editprofile').hide()
  }

  $(function(){

    $('#p-profile').hide()
    $('#p-editprofile').hide()
    $('#searchbtn').click(function(){
      $.post("http://139.59.234.220:5050/api/v1/getpatientinfo",
      {
          patient_id : $('#searchbox').val()
      })
      .done(function(data,status){
          // alert("Status: " + status);
          $('#p-name').text(data[0].firstname+" "+data[0].lastname)
          $('#citizenId').text(data[0].ssn)
          $('#p-address').text(data[0].address)
          if(data[0].gender==="W") $('#sex').text("หญิง")
          else $('#sex').text("ชาย")
          $('#bloodtype').text(data[0].blood)
          $('#p-email').text(data[0].email)
          $('#tel-no').text(data[0].tel)

          // getUsrPwd(data[0].password)

          var tmp = $('#p-fname')
          tmp.val(data[0].firstname)
          tmp = $('#p-lname')
          tmp.val(data[0].lastname)
          tmp = $('#cid')
          tmp.val(data[0].ssn)
          tmp = $('#p-addr')
          tmp.val(data[0].address)
          if(data[0].gender==="W"){
            tmp = $('#female')
            tmp.prop('checked',true)
          }
          else {
            tmp = $('#male')
            tmp.prop('checked',true)
          }
          tmp = $('#m-blood-1')
          var bld = data[0].blood.split(" ")
          tmp.val(bld[0])
          tmp = $('#m-blood-2')
          tmp.val(bld[1])
          tmp = $('#m-email')
          tmp.val(data[0].email)
          tmp = $('#m-tel')
          tmp.val(data[0].tel)
          $('#searchbar').hide()
          $('#p-profile').show()
          $('#p-editprofile').hide()
      })
      .fail(function(xhr,status,error){
        alert(status + ": " + xhr.responseText)
      });
    })
    $('#editBtn').click(function(){
      $('#p-profile').hide()
      $('#p-editprofile').show()
    })
    $('#confirmButton').click(function(){
      // alert($('#searchbox').val()+":haha")
      $.post("http://139.59.234.220:5050/api/v1/editpatientinfo",
      {
          patient_id : $('#searchbox').val(),
          firstname : $('#p-fname').val(),
          lastname : $('#p-lname').val(),
          email : $('#m-email').val(),
          // password : usrpwd,
          gender : ($('input[name=sexOption]:checked').val()==="หญิง") ? "W" : "M",
          tel : $('#m-tel').val(),
          ssn : $('#cid').val(),
          address : $('#p-addr').val(),
          blood : $('#m-blood-1').find(":selected").text()+" "+$('#m-blood-2').find(":selected").text()
      }).done(function(data,status){
        $('#searchbtn').click()
      })
      .fail(function(xhr,status,error){
        alert(status+": "+xhr)
      });
    })
  })
  </script>
</body>
</html>
