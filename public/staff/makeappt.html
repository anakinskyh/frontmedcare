
<!doctype html>
<html lang="en">
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js">
</script>
<style type"text/css">
.top-buffer { margin-top:20px; }
</style>
</head>
<body>
  <div class="header"></div>
  <script>
      $(".header").load("/assets/html/header.html");
  </script>
  <div id="wrapper">
    <nav class="navbar navbar-inverse navbar-fixed-top navigatebar" role="navigation"></nav>
    <script>
      $(".navigatebar").load("/assets/html/staffnav.html", function(){
        $("#makeappt").addClass("active");
      });
    </script>

    <!-- page content -->
    <div id="page-wrapper">

        <div class="container-fluid">

            <!-- Page Heading -->
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">
                        ทำการนัดหมาย
                    </h1>
                    <ol class="breadcrumb">
                            <label>ID ของผู้ป่วย</label>
                            <input class="form-control" placeholder="กรอกIDของผู้ป่วย" id="patientid">
                        </li>
                    </ol>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <ol class="breadcrumb">
                        <label>อาการของผู้ป่วย</label>
                        <input class="form-control" placeholder="กรอกอาการของผู้ป่วย" ng-model="detail" id="detail">
                        </li>
                    </ol>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <ol class="breadcrumb">
                        <li class="form-group">
                            <label>แผนกและแพทย์ที่ต้องการพบ</label>
                            <select class="form-control"id="dept" onchange="getDocName()">
                                <option class="disabled"> --รายชื่อแผนก--</option>
                                <option value="อายุรกรรม"> อายุรกรรม</option>
                                <option value="ศัลยกรรม"> ศัลยกรรม</option>
                                <option value="สูติ"> สูติ</option>
                                <option value="จักษุ"> จักษุ</option>
                                <option value="โรคผิวหนัง"> โรคผิวหนัง</option>
                                <option value="อวัยวะปัสสาวะ"> อวัยวะปัสสาวะ</option>
                                <option value="หัวใจ"> หัวใจ</option>
                                <option value="หู คอ จมูก"> หู คอ จมูก</option>
                                <option value="รังสี"> รังสี</option>
                                <option value="รักษาโรคในช่องปากและฟัน"> รักษาโรคในช่องปากและฟัน</option>
                            </select>
                        </li>
                        <li class="form-group">
                            <select class="form-control" id="dname" onchange="myFunction3()">
                            </select>
                        </li>
                    </ol>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <ol class="breadcrumb">
                        <li class="form-group">
                            <label>เลือกเวลาและวันที่ที่ต้องการนัดพบ</label>
                            <input type="date" class="form-control" id="date" onchange="myFunction()">
                        </li>
                        <li class="form-group">
                            <select class="form-control" ng-model="time" id="time">
                                <option>เช้า</option>
                                <option>บ่าย</option>
                            </select>
                        </li>
                    </ol>
                </div>
            </div>

            <br>

            <div class="row">
                <div class="col-lg-12">
                    <!--<h2>Bordered with Striped Rows</h2>-->
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover table-striped">
                            <thead>
                                <tr>
                                    <th>วันที่</th>
                                    <th>เวลา</th>
                                    <th>ชื่อแพทย์</th>
                                    <th>รายละเอียด</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td id="cdate"></td>
                                    <td>{{time}}</td>
                                    <td id="doctname"></td>
                                    <td>{{detail}}</td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" type="button" onclick="myFunction2()"> ยืนยันการทำนัดหมาย</button>

        </div>
        <!-- /.container-fluid -->

    </div>
    <!-- /#page-wrapper -->
  </div>
  <script>
      function myFunction() {
          var x = document.getElementById("date").value;
          document.getElementById("cdate").innerHTML = x;
      }
  </script>

  <script>
      function myFunction2() {
          var name = document.getElementById("doctname").innerHTML;
          var pid = document.getElementById("patientid").value;
          var s = document.getElementById("detail").value;
          var date = document.getElementById("cdate").innerHTML;
          var st,e;
          if(document.getElementById("time").value=='เช้า'){
              st = date+" 09:00:00";
              e = date+" 11:30:00";
          }else{
              st = date+" 13:00:00";
              e = date+" 15:30:00";
          }
          var markers = {'patient_id': pid,'syntom': s,'start':st,'end':e,'name':name};
          $.ajax({
              type: "POST",
                  url: "http://139.59.234.220:5050/api/v1/confirmappt",
                  data: JSON.stringify(markers ),
                  contentType: "application/json; charset=utf-8",
                  dataType: "json",
                  async: false,
                  timeout: 2000,
              success: function(data){alert(data.status);

              },
              failure: function(errMsg) {
                  alert(errMsg);
              }
          });
      }
  </script>

  <script>
      function myFunction3() {
          var x = document.getElementById("dname").value;
          document.getElementById("doctname").innerHTML = x;
      }
  </script>

  <script type="text/javascript">
      function getDocName() {
          var sendData = document.getElementById("dept").value;
          var markers = {'deptname': sendData};
          var list;
          $.ajax({
              type: "POST",
              url: "http://139.59.234.220:5050/api/v1/getdoctorname",
              data: JSON.stringify(markers ),
              contentType: "application/json; charset=utf-8",
              dataType: "json",
              async: false,
              timeout: 2000,
              success: function(data){//alert(data);
                  var namelist = document.getElementById("dname");
                  namelist.length=0;
                  for (i=0;i<data.length;i++){
                      var option = document.createElement("option");
                      option.text = data[i].firstname + " " + data[i].lastname;
                      option.value = data[i].firstname + " " + data[i].lastname;
                      namelist.appendChild(option);
                  }
                  document.getElementById("doctname").innerHTML = data[0].firstname + " " + data[0].lastname;
              },
              failure: function(errMsg) {
                  alert(errMsg);
              }
          });
      }
  </script>
</body>
